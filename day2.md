# SKY130 Day 2: Good vs Bad Floorplan and Introduction to Library Cells

## Chip Floor Planning Considerations

### Utilisation Factor and Aspect Ratio

The first step in physical design is to **define the width and height of the core and die**. Beginning with a simple netlist, we can extrapolate later and first draw a basic diagram. All logical cells will be placed inside the core. If the logical cells occupy the core fully, it is known as 100% utilisation.

- Utilisation factor = Area occupied by netlist / Total area of core.
- In practice, the utilisation factor is usually around 50%.
- Aspect Ratio is the ratio between height and width. If the chip is square, it is 1; otherwise, the chip is rectangular.

### Concept of Pre-Placed Cells

Pre-placed cells are reusable, complex logic blocks that are not modifiable by tools afterwards and therefore require careful design. Their placement is user-determined. Combinational logic, sequential logic, and memory cells are examples of pre-placed cells.

### De-Coupling Capacitors

Decoupling capacitors are used to stabilize important cells. When a circuit is powered on, it demands current from Vdd and discharges to the ground when turned off. Due to resistance, inductance, and other factors, decoupling capacitors help in maintaining a stable voltage supply.

### Power Planning

When there are many macros in a circuit, each requires a specific voltage. Adding many decoupling capacitors is inconvenient, so adding more power rings and straps for better distribution is necessary.

### Pin Placement and Logical Cell Placement Blockage

The netlist is implemented with input and output ports placed left and right between the core and the die. After pin placement, Logical Cell Placement Blockage is created to ensure that the APR tool does not place any cell on the pin locations.

### Steps To Run Floorplan Using Openlane

To run a floorplan using Openlane, type the command `run_floorplan` which will generate the output stored in the runs/(date and time)/logs/floorplan folder. `



### Review Floorplan Layout in Magic

Type the command:-

` magic -T /home/vsduser/Desktop/work/tools/openlane_working_dir/pdks/sky130A/libs.tech/magic/sky130A.tech lef read ../../tmp/merged.lef def read picorv32a.floorplan.def & `

## Library Binding and Placement

### Netlist Binding and Initial Place Design

The first step is to bind the netlist with physical cells with real dimensions. These blocks are sourced from a library containing cells with various shapes, dimensions, and delays. The second step is placement based on connectivity.

### Optimise Placement Using Estimated Wire-Length and Capacitance

Estimate the wirelength needed to connect the components together. If too long, install repeaters to maintain signal integrity.

### Congestion Aware Placement Using RePLACE

The command to run placement in OpenLANE is `run_placement`, which performs:
- Global Placement
- Optimization
- Detailed Placement

After running the placement, output is generated in `openlane/designs/picorv32a/runs/[design - date]/results/placement/picorv32a.placement.def`.

## Cell Design and Characterisation Flows

### Inputs for Cell Design Flow

Standard cells, such as AND, OR, and BUFFER gates, are stored in the standard cell library with various drive strengths and sizes.

### Circuit Design Step

Process involves circuit, layout design, and characterisation.

### Layout Design Step

Output includes Circuit Description Language, GDSII, LEF, timing, noise, etc.

### Typical Characterisation Flow

Steps include:
- Reading SPICE module files
- Reading netlist extracted by SPICE
- Recognising buffer behaviour
- Reading subcircuits
- Attaching necessary power sources
- Applying stimulus
- Providing necessary output capacitance
- Provision of simulation command

These steps are given to the software called GUNA in the form of a configuration file, generating timing, noise, and power models in the form of .libs files.

## General Timing Characterisation Parameters

### Timing Threshold Definitions

Discuss various .libs files generated by GUNA using an example circuit with inverters.

### Propagation Delay and Transition Time

Propagation delay is calculated as `time(out_x_thr) - time_x_thr`. If negative, unexpected results occur. Transition time is calculated as `time(slew_high_x_thr) - time(slew_low_x_thr)`.
